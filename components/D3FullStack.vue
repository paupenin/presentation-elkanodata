<template>
  <svg
    id="D3FullStack"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="200 0 4081.6327 4444.4444"
    height="1000"
    width="1000"
  >
    <path
      v-for="shape in shapes"
      :key="shape.ref"
      v-bind:ref="shape.ref"
      v-bind:d="shape.d"
      v-bind:altd="shape.altd"
      v-bind:fill="shape.fill"
      v-bind:duration="shape.duration"
    />

    <text v-for="(text, index) in texts"
      :key="index"
      v-bind:x="text.x"
      v-bind:y="text.y" 
      font-size="300px">
      {{ text.content }}
    </text>

  </svg>
</template>

<script>
import * as d3 from "d3";
import {morphPath as d3morphPath} from "d3-path-morphing";

export default {
  mounted() {
    this.initD3();
  },

  data() {
    return {
      'texts': [
        {
          'content': 'Front-end',
          'x': 800,
          'y': 1400,
        },
        {
          'content': 'Back-end',
          'x': 2600,
          'y': 1400,
        },
        {
          'content': 'Dev-ops',
          'x': 2600,
          'y': 3000,
        },
        {
          'content': 'Analysis',
          'x': 800,
          'y': 3000,
        },
        {
          'content': 'ME',
          'x': 2000,
          'y': 2200,
        },
      ],
      'shapes': [
        {
          'ref': "TR",
          'd': "m 2319.6878,818.68041 c -151.3588,251.47309 -241.3255,547.36589 -201.8583,845.02159 47.0813,355.7062 440.492,616.8308 753.2429,670.9268 373.5236,64.6226 993.7593,31.3546 1254.16,-256.6316 134.9086,-149.1243 17.8003,-390.7628 32.1334,-699.2561 14.3333,-337.7346 -8.5245,-702.07841 -297.7687,-872.84627 C 3449.6669,261.35166 2888.518,146.85948 2717.8181,392.59205 2572.1172,602.37951 2490.8264,533.87223 2319.6878,818.68041 Z",
          'altd': "m 2074.7138,652.59631 c -151.3588,251.47309 -108.4583,775.73149 88.7888,977.88889 250.519,256.8731 388.496,409.0857 678.5051,538.0595 332.0026,147.6647 1197.8043,178.8017 1125.4448,-202.6543 -35.3276,-186.4932 96.6903,-382.4586 -34.3002,-649.4308 C 3783.0336,1013.5826 4090.7119,747.24843 3801.4677,576.48057 3391.5375,331.9374 3029.6895,267.27045 2800.8601,421.65677 2589.1374,564.53084 2245.8524,367.78813 2074.7138,652.59631 Z",
          'fill': "#00C58E",
          'duration': 10000,
        },
        {
          'ref': "BR",
          'd': "m 2021.0913,2112.6786 c -156.5008,607.604 133.1546,932.0326 188.9081,1265.5874 55.7535,333.555 452.4196,222.3828 670.2167,421.8081 217.471,199.4254 555.2552,81.4253 957.2639,-85.2382 180.6183,-75.9412 326.3695,-309.0899 108.9287,-636.8065 -172.4896,-256.4941 -7.6376,-820.124 -235.216,-940.101 -227.5783,-119.9767 -308.0769,91.9794 -551.2312,-124.9624 -258.0383,-229.8886 -982.0432,-507.827 -1138.8702,99.7126 z",
          'altd': "m 2112.4376,2216.4812 c 4.7822,599.8528 -259.7703,816.1364 118.3223,1145.1764 288.9868,251.4946 311.2636,558.0267 566.4142,409.3518 379.4029,-215.7849 481.2596,5.5785 757.9629,-105.9987 450.505,-204.6564 -22.407,-446.1093 30.0388,-802.8907 43.0523,-306.0855 241.4885,-529.4768 238.1237,-724.1916 -4.4452,-257.2286 -399.5691,-300.3583 -671.6422,-220.4608 -519.515,152.9674 -1045.5236,-547.9183 -1039.2197,299.0136 z",
          'fill': "#108775",
          'duration': 12000,
        },
        {
          'ref': "BL",
          'd': "m 493.57447,2328.015 c -26.18209,264.6898 120.44488,452.8529 305.95465,720.5094 185.50973,267.9862 -235.60489,553.2081 28.4512,844.9274 264.05598,291.3897 1230.91578,161.4893 1435.90248,-96.6081 203.7095,-258.427 219.0356,-551.7945 125.1632,-934.161 -90.6795,-382.6962 0,-555.4204 -333.0235,-872.1912 -332.385,-316.6457 -738.2075,-302.1686 -966.8218,-209.2799 -228.61442,92.8558 -569.12498,282.4431 -595.62623,546.8034 z",
          'altd': "m 547.5518,2535.6201 c 65.16417,223.1688 130.93199,345.264 56.8285,662.38 -96.83324,413.3098 46.46795,593.8563 439.5093,612.4097 372.0107,17.3509 471.0811,-320.1546 912.7376,-150.5855 307.6284,116.8197 729.7442,-402.3188 635.8718,-784.6853 -90.6795,-382.6962 -149.4757,-709.0482 -536.4765,-884.6475 -417.9026,-190.0045 -700.8386,-405.9712 -1029.1033,2.4773 -154.60086,192.3158 -553.50037,287.5181 -479.3674,542.6513 z",
          'fill': "#2F495E",
          'duration': 14000,
        },
        {
          'ref': "TL",
          'd': "m 294.64684,893.29834 c -135.86751,251.47316 -129.4344,688.33496 66.64711,882.20336 214.60891,212.2902 395.40861,616.8307 676.15005,670.9267 335.2941,64.6227 798.9967,-149.9017 1125.7991,-256.6315 261.6995,-85.3839 315.317,-491.685 328.1831,-800.1782 C 2504.2926,1051.884 2438.4199,708.787 2178.7792,538.01914 1810.8046,293.47596 1313.3957,386.69654 899.87488,504.39185 674.9729,568.42986 448.2697,608.49014 294.64684,893.29834 Z",
          'altd': "m 427.51412,889.14624 c 72.67199,276.43716 273.31954,451.66516 166.29757,799.16126 -88.92126,288.4738 411.65341,809.9356 626.32481,621.1015 252.2521,-221.8724 558.8708,-171.9995 897.4335,-231.7189 319.8289,-56.3191 298.3519,-500.2746 157.9469,-775.2656 C 2101.5387,964.68985 2733.2192,580.07182 2062.5203,409.30396 1634.8837,298.24725 1429.2326,559.32862 978.76483,458.71872 679.84809,391.99183 298.79401,400.88502 427.51412,889.14624 Z",
          'fill': "#00788e",
          'duration': 16000,
        },
        {
          'ref': "C",
          'd': "m 1866.4081,1814.4596 c -48.2715,215.8766 -0.1815,361.0979 89.0505,370.0799 140.255,14.118 108.7625,158.5834 175.9404,229.4376 67.0774,70.8542 190.8738,82.8537 295.2612,-30.2844 103.6832,-113.3667 100.6662,-235.0758 35.0974,-306.1586 -138.0339,-211.7302 -212.9366,-204.2199 -244.0732,-298.5016 -39.12,-129.0003 -302.904,-180.4267 -351.2763,35.4271 z",
          'altd': "m 1870.5602,1947.3269 c 53.2395,214.7054 -39.0203,302.9424 35.0731,353.4715 148.5592,101.3121 46.481,171.0397 196.701,187.9165 96.9507,10.9656 265.9853,56.103 345.0864,-75.9575 74.6185,-125.823 12.9785,-204.5323 -2.2715,-405.809 -28.6452,-172.4315 -33.8698,-254.0885 -131.9664,-269.4369 -275.7899,-50.1104 -502.205,-30.951 -442.6226,209.8154 z",
          'fill': "#ffe269",
          'duration': 20000,
        },
      ],
    };
  },

  methods: {
    initD3() {
      let svg = d3.select("#D3FullStack");
      
      svg.selectAll('path').each((a, i, paths) => {
        let d3path = d3.select(paths[i]);

        this.loopMorphPath(d3path)
      })
    },

    loopMorphPath(path) {
      if (!path) return;

      let duration = path.attr('duration') || 1000;
      let source = path.attr('d');
      let alternative = path.attr('altd');
      let isReverse = false;

      function morph() {
        path.transition()
          .ease(d3.easeLinear)
          .duration(duration)
          .attrTween('d', () => {
            if (isReverse) {
              isReverse = false;
              return d3morphPath(alternative, source);
            }

            isReverse = true;
            return d3morphPath(source, alternative);
          }).on('end', morph)
      }

      morph()
    }
  }
}
</script>

<style>
#D3FullStack {
  animation: 1s appear;
  margin: auto;
  max-width: 100%;
  max-height: 100vh;
}

@keyframes appear {
  0% {
    opacity: 0;
  }
}

svg path {
  opacity: 0.8;
}
</style>
